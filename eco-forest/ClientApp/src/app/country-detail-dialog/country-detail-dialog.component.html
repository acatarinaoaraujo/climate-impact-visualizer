<div class="wrap-container">
  <h1 mat-dialog-title>{{ data.name }}</h1>

  <div mat-dialog-content>
    <!-- Grid to display value and rate of change -->
    <mat-grid-list cols="2" rowHeight="100px" gutterSize="16px">
      <mat-grid-tile>
        <mat-icon color="primary">bar_chart</mat-icon>
        <div class="metric-text">Value: {{ data.value }} {{unit}}</div>
      </mat-grid-tile>
      <mat-grid-tile>
        <mat-icon color="accent">trending_up</mat-icon>
        <div class="metric-text">Change: {{ data.rateChange }}%</div>
      </mat-grid-tile>
    </mat-grid-list>

    <!-- Chart section -->
    <div class="chart-container" *ngIf="chartData">
      <h3>Chart for {{ data.indicatorType }}</h3>
      <canvas baseChart
        [data]="chartData"
        [options]="chartOptions"
        [type]="chartType">
      </canvas>
    </div>

    <!-- User prompt input field -->
    <mat-form-field appearance="outline" class="prompt-input">
      <mat-label>Ask a question about {{ data.name }}</mat-label>
      <input matInput [(ngModel)]="userPrompt" placeholder="Type your question here">
    </mat-form-field>

      <!-- Chart section -->
      <div class="chart-container" *ngIf="chartData">
        <h3>Chart for {{ data.indicatorType }}</h3>
        <canvas baseChart
          [data]="chartData"
          [options]="chartOptions"
          [type]="chartType">
        </canvas>
      </div>


    <!-- Loading spinner while fetching data -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Fetching information...</p>
    </div>

    <!-- Display LLM response once it's available -->
    <div *ngIf="llmResponse">
      <div class="response-section">
        <h3>Response:</h3>
        <p><strong>Current Year Summary:</strong> {{ llmResponse.currentYearSummary }}</p>
        <p><strong>Historical Comparison:</strong> {{ llmResponse.historicalComparison }}</p>

        <mat-list>
          <h3 mat-subheader>Recent News Headlines</h3>
          <mat-list-item *ngFor="let headline of llmResponse.newsHeadlines">
            <a href="{{ headline.url }}" target="_blank" rel="noopener noreferrer">
              {{ headline.title }}
            </a>
          </mat-list-item>
        </mat-list>
      </div>
    </div>
  </div>

  <!-- Dialog action buttons -->
  <div mat-dialog-actions align="end">
    <button mat-raised-button color="warn" (click)="closeDialog()">Close</button>
    <button mat-raised-button color="primary" (click)="submitPrompt()" [disabled]="isLoading || !userPrompt.trim()">Submit</button>
  </div>
</div>
